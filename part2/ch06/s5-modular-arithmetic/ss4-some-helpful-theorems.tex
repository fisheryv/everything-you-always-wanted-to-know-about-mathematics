% !TeX root = ../../../book.tex

\subsection{一些有用的定理}

在本节中，我们将探讨数论中的一些定理，这些定理涉及模运算，既实用又有趣。我们将陈述并证明这些定理（有时需要你通过练习给予帮助），并用例子展示其实际应用。

\subsubsection*{中国剩余定理}

为了引出这个定理，我们通过一个故事说明其用途：

\begin{quotation}
    孙武\footnote{在中国，这个故事的主角是韩信。因此这个问题也被称为``韩信点兵''问题。—— 译者注}将军的部队有许多士兵。战斗结束后，他想快速统计剩余士兵的数量。逐个清点显然太费时，因此他想用更高效的方法完成点兵。幸运的是，士兵们训练有素，能轻松组成等大小的队列。
    
    孙武将军先命令士兵排成两列等长的队列，结果多出一人。

    接着，他让士兵排成三个等大小的环形队列，但仍多出一人。

    最后，他命令士兵排成五个等大小的侧翼队列，这次多出两人。

    至此，他认为信息已经足够。战斗结束后，他推测部队总人数在 $250$ 到 $300$ 之间。根据这些信息，他能\emph{准确}得知士兵数量。
    
    你能算出具体人数吗？这支部队究竟有多少士兵？
\end{quotation}

请先尝试自行解决此问题，检验自己能否找到答案，然后再继续阅读书中的解决方案、定理陈述及问题解决方法。

回顾这个故事。设士兵数量为 $x$，其满足以下三个同余条件和一个不等式：
\begin{align*}
    x \equiv 1 \mod 2 \\
    x \equiv 1 \mod 3 \\
    x \equiv 2 \mod 5 \\
    250 \le x \le 300
\end{align*}
（你能从故事中找到这些条件的来源吗？）

现在有两个问题需要考虑：
\begin{enumerate}[label=(\arabic*)]
    \item 是否\emph{一定}存在满足所有同余条件的 $x$？
    \item 是否存在\emph{多个}满足条件的 $x$？能否保证其中之一满足不等式？
\end{enumerate}

下面陈述的\textbf{中国剩余定理}可以保证：
\begin{enumerate}[label=(\arabic*)]
    \item 同余方程有无穷多个解；
    \item 至少有一个解满足给定的不等式。
\end{enumerate}
但在陈述并证明该定理前，我们先尝试解决原始问题。我们将其分解为以下步骤：
\begin{itemize}
    \item 第一个同余条件要求 $x$ 必须是\textbf{奇数}，这样就排除了所有偶数作为潜在解。以下是潜在解列表：
    \[1,\cancel{2}, 3, \cancel{4}, 5, \cancel{6}, 7, \cancel{8}, 9,\cancel{10}, 11,\cancel{12}, 13,\cancel{14}, 15,\cancel{16}, 17,\cancel{18}, 19,\cancel{20}, 21,\cancel{22}, 23, \dots\]

    \item 第二个同余条件要求解必须是 $3$ 的倍数加 $1$，这就排除了模 $3$ 余 $0$ 或 $2$ 的数。以下是潜在解列表：
    \[1,\cancel{2}, \cancel{3}, \cancel{4}, \cancel{5}, \cancel{6}, 7, \cancel{8}, \cancel{9},\cancel{10}, \cancel{11},\cancel{12}, 13,\cancel{14}, \cancel{15},\cancel{16}, \cancel{17},\cancel{18}, 19,\cancel{20}, \cancel{21},\cancel{22}, \cancel{23}, \dots\]

    \item 第三个同余条件要求解必须是 $5$ 的倍数加 $2$，这就排除了模 $5$ 余 $0, 1, 3, 4$ 的数。以下是潜在解列表：
    \[\cancel{1},\cancel{2}, \cancel{3}, \cancel{4}, \cancel{5}, \cancel{6}, \circled{7}, \cancel{8}, \cancel{9},\cancel{10}, \cancel{11},\cancel{12}, \cancel{13},\cancel{14}, \cancel{15},\cancel{16}, \cancel{17},\cancel{18}, \cancel{19},\cancel{20}, \cancel{21},\cancel{22}, \cancel{23}, \dots\]
\end{itemize}
表面上看 $7$ 是唯一解，但我们仅检查了前 $23$ 个潜在解……能否\emph{确保}无其他解？请自行探究：尝试更大的数值，观察能否找到其他解。你能发现规律吗？$7$ 真的是唯一解？

现在，我们用更巧妙的方法来解决这些同余问题。具体来说，假设我们有一个解 $x$，它满足所有三个同余式，看看我们能否推导出更多的信息。通过此推导，我们将揭示所有\emph{潜在}解的特性。

根据同余的定义，可知存在 $k, \ell, m \in \mathbb{Z}$ 使得
\begin{align*}
    x &= 2k + 1 \\
    x &= 3\ell + 1 \\
    x &= 5m + 2 
\end{align*}
给定这样的 $k, \ell, m$。

先来看前两个方程，试着将它们合并成一个关于 $x$ 的方程。具体来说，把第一个方程乘以 $3$，第二个方程乘以 $2$，这样就会分别得到 $6k$ 和 $6\ell$ 项。
\begin{align*}
    3x &= 6k + 3 \\
    2x &= 6\ell + 2
\end{align*}
然后两式相减，并进行因式分解可得：
\[(3x - 2x) = (6k + 3) - (6\ell + 2) \implies x = 6(k - \ell) + 1\]
因为 $k, \ell \in \mathbb{Z}$ 已经给定，我们可以令 $u = k-\ell$ ($u \in \mathbb{Z}$)。此时 $x = 6u+1$，即
\[x \equiv 1 \mod 6\]
现在，我们通过合并前两个同余式得到了这个新的同余式。这并非巧合，因为这个同余式是模 $6$ 的，而 $6 = 2 \times 3$。稍后，当我们引导你证明接下来的定理时，你会明白其中的原理！

接下来，我们尝试将这个新的同余式与上面的第三个同余式合并。我们采用类似的方法：将刚刚推导出的同余式乘以 $5$，将第三个同余式乘以 $6$，这样相减后可以提出因子 $30$。（这也解释了为什么新推导出的同余式是模 $30$ 的。）
\begin{align*}
    5x &= 30u + 5 \\
    6x &= 30m + 12
\end{align*}
然后两式相减，并进行因式分解可得：
\[(6x - 5x) = (30m + 12) - (30u + 5) \implies x = 30(m - u) + 7\]
同理，因为 $u,m$ 已经给定，我们可以令 $v = m-u$ ($v \in \mathbb{Z}$)。此时 $x = 30v+7$，即
\[x \equiv 7 \mod 30\]
这个最终的同余式是通过将给定的三个同余式合并推导出来的，因此它包含了这三个同余式的所有信息。我们断言，该同余式包含了\textbf{所有的}解！

首先，这个新推导出的同余式表明，任何解必须满足模 $30$ 余 $7$。换句话说，任何除以 $30$ 余数不为 $7$ 的数都不可能是解。这本质上将我们通过上述三种观察排除潜在解的工作总结为一个陈述。

其次，我们可以证明：任何模 $30$ 余 $7$ 的数确实是一个解。设 $n \in \mathbb{Z}$，并定义 $y = 30n + 7$（即任意满足 $y \equiv 7 \mod 30$ 的整数 $y$）。注意 $y$ 满足：
\begin{itemize}
    \item 第一个同余式，因为 $y = 30n + 7 = 2(15n + 3) + 1$，所以 $y \equiv 1 \mod 2$。
    \item 第二个同余式，因为 $y = 30n + 7 = 3(10n + 2) + 1$，所以 $y \equiv 1 \mod 3$。
    \item 第三个同余式，因为 $y = 30n + 7 = 5(\enspace 6n + 1) + 2$，所以 $y \equiv 2 \mod 6$。
\end{itemize}
至此，我们得到：
\begin{enumerate}[label=(\arabic*)]
    \item \emph{任何}解 $x$ 必须满足 $x \equiv 7 \mod 30$；
    \item 任何满足此条件的 $x$ 实际上\emph{就是}一个解。
\end{enumerate}
这两个陈述构成了一个 $\iff$ 陈述，即
\[x \text{\ 是三个同余式的解} \iff x \equiv 7 \mod 30\]
因此\textbf{所有解}的集合 $S$ 为
\[S = \{x \in \mathbb{Z} \mid x \equiv 7 \mod 30\} = \{30n + 7 \mid n \in \mathbb{Z}\}\]

回到原问题，我们只需考虑不等式 $250 \le x \le 300$。是否存在满足 $x \equiv 7 \mod 30$ 且在此范围内的 $x$？答案是肯定的！我们可以从 $7$ 开始累加 $30$ 的倍数，或者从接近 $300$ 的数开始逐步调整。无论采用哪种方法，最终得到 $\mathbf{x = 277}$，这就是孙武将军的士兵数量。

现在，为便于比较，考虑以下同余方程组：
\begin{align*}
    x &\equiv 3 \mod 4 \\
    x &\equiv 2 \mod 6
\end{align*}
该同余方程组有解吗？先前的方法在此是否适用？若尝试``排除候选值''或``合并同余式''，会发现这些方法均\emph{无效}。分析可知：第一个同余式要求 $x$ 比 $4$ 的倍数多 $3$，故 $x$ 为\emph{奇数}；第二个同余式要求 $x$ 比 $6$ 的倍数多 $2$，故 $x$ 为\emph{偶数}。一个数如何同时即是奇数又是偶数？这显然不可能。

\textbf{中国剩余定理}阐明了同余方程组有解的条件。它适用于我们解决的第一个问题，并指出存在无穷多个解，且均模 $30$ 同余。然而，该定理并未直接说明第二个问题无解——它仅对特定情况提供\emph{保证}。当条件满足时，我们能有效判定解；但当条件\emph{不满足}时，定理并\emph{不保证}有解。现在，让我们陈述该定理，进一步探讨其内涵，并请你协助完成证明（使用两种不同的方法！）。

\begin{theorem}[中国剩余定理]\label{theorem6.5.28}
    考虑由 $r$ 个同余方程组成的方程组。设 $r \in \mathbb{N}$，给定 $r$ 个自然数 $n_1, n_2, \dots, n_r$ 和 $r$ 个整数 $a_1, a_2, \dots, a_r$，该方程组表示为：
    \begin{align*}
        x &\equiv a_1 \mod n_1 \\
        x &\equiv a_2 \mod n_2 \\
        \vdots \\
        x &\equiv a_r \mod n_r
    \end{align*}
    （换句话说，该方程组要求 $x \in \mathbb{Z}$ 满足 $\forall i \in [r] \centerdot x \equiv a_i \mod n_i$。）

    \dotuline{如果}模数 $n_i$ 两两互质，即任意两个 $n_i$ 之间除了 $1$ 以外没有其他公因数，\dotuline{那么}此同余方程组必有解。

    此时，方程组存在无穷多个解，且所有解模 $N$ 同余，其中 $N$ 为模数的乘积：
    \[N = \prod_{i \in [r]}^{} n_i\]
\end{theorem}

请注意，定理的核心是``\textbf{如果……那么……}''形式的条件陈述。该结论未涉及模数不互质的情形，这种情况下解的存在性不确定。例如，此前讨论的模数为 $4$ 和 $6$ 的方程组（$4$ 与 $6$ 有公因数 $2$），定理并没有说这种情况下无解，其解的存在性取决于具体参数。若修改为：
\begin{align*}
    x \equiv 3 \mod 4 \\
    x \equiv 5 \mod 6
\end{align*}
这个方程组就有解。你可以试着解一下。

中国剩余定理的一种证明方法基于逐步合并同余方程的思想。对于含任意数量方程的方程组，可以通过迭代将同余关系归约为一个模数为全体模数乘积的同余方程。此过程的有效性可以通过数学归纳法证明（以方程数量 $r$ 为归纳变量），详见练习 \ref{exc:exercises6.7.26}。该证明的优势在于提供了实际求解的操作方法。

另一种证明是\textbf{构造性}的。也就是说，直接利用定理条件定义解 $X$ 并验证其有效性（见练习 \ref{exc:exercises6.7.27}）。相较而言，我们更喜欢构造性证明，因为它不是通过论证某个对象存在的原因来证明，而是实际构造出此对象。然而，此证明方法构造解的方式有点``非自然''，即不是通过``排除候选值''也不是通过``合并同余式''来构造解，其构造解的方式较为间接，但避免了归纳流程。为了比较这两种方法，建议你尝试完成定理的两种证明。如果只能选择一种方法，我们会推荐使用归纳法证明。

\subsubsection*{贝祖恒等式 (Bézout's Identity)}

这一定理让我们回想起之前关于线性丢番图方程的讨论。在示例 \ref{ex:example6.5.26} 中，我们通过巧妙地应用乘法逆元解决了一个特定方程。除了展示该方法外，还有一种更简单的方法可以验证此类方程是否有解。该定理精确描述了二元线性丢番图方程解的存在条件，称为\textbf{贝祖恒等式 (Bézout's Identity)}，以 $18$ 世纪法国数学家 Étienne Bézout 命名。

在陈述定理前，需要先给出一个定义。尽管你可能早已熟悉此概念，但它在定理中至关重要，因此我们在此给出正式定义并提供示例说明。

\begin{definition}[最大公约数]\label{def:definition6.5.29}
    给定 $a,b \in \mathbb{Z}$。$a$ 和 $b$ 的\dotuline{最大公约数}记为 $\gcd(a, b)$，定义为能同时整除 $a$ 和 $b$ 的最大整数，即：
    \[\gcd(a, b) \mid a \land \gcd(a, b) \mid b\]
    且满足：
    \[\forall d \in \mathbb{Z} \centerdot (d \mid a \land d \mid b) \implies d \le \gcd(a, b)\]
\end{definition}

我们假设你对此概念已有基本了解或直观认识。后续定理及其证明无需深入理解该定义，相关练习也不要求很强的计算能力或预备知识。请将其视为练习吸收新数学定义的机会，帮助你运用抽象概念证明结论、寻找例证与反例。这是一项关键技能！在陈述定理前，先看几个具体示例。

\begin{example}
    求两个整数的最大公约数时，常用的方法是对其进行\textbf{质因数分解}后组合公有因子。即 $\gcd(a, b)$ 是 $a$ 和 $b$ 公有质因数的乘积。

    以下是一些关于最大公约数的具体实例和一般性结论，这些论断仅依赖于最大公约数的定义。

    \begin{itemize}
        \item 设 $a=15, b=6$。因为 $a = 3 \cdot 5, b = 2 \cdot 3$，我们发现它们的公因子只有 $3$。因此
            \[\gcd(6, 15) = 3\]
        \item 设 $a=30, b=40$。因为 $a = 2 \cdot 3 \cdot 5, b = 2^3 \cdot 5$，我们发现它们的公因子有 $2$ 和 $5$。因此
            \[\gcd(30, 40) = 10\]
        \item 一般来说，
            \[\gcd(a, b) = \gcd(b, a)\]
            这显然是正确的，因为 $a$ 和 $b$ 的任何公约数也是 $b$ 和 $a$ 的公约数。
        \item 设 $a=77, b=72$。因为 $a = 7 \cdot 11, b = 2^3 \cdot 3^2$，我们发现它们没有公因子。因此
            \[\gcd(77, 72) = 1\]
        \item 设 $a=13$，设 $b \in \mathbb{N}$ 且 $a \nmid b$。因为 $a$ 为质数，且 $b$ 不是 $13$ 的倍数，因此 $b$ 的质因子中没有 $13$。因此
            \[\gcd(13, b) = 1\]
            这意味着 $a$ 和 $b$ \textbf{互质}。一般有：
            \[a \text{\ 与\ } b \text{\ 互质} \iff \gcd(a, b) = 1\]
            此外
            \[\forall a, b \in \mathbb{N} \centerdot a \text{\ 为质数} \implies \big(\gcd(a,b)=1 \iff a \nmid b\big)\]
    \end{itemize}
\end{example}

现在，我们已经准备好陈述并证明\textbf{贝祖恒等式}了！

\begin{theorem}[贝祖恒等式]\label{theorem6.5.31}
   给定 $a, b \in \mathbb{Z}$。定义 $L$ 为 $a$ 和 $b$ 所有线性组合的集合；即定义
   \[L = \{z \in \mathbb{Z} \mid \exists x, y \in \mathbb{Z} \centerdot ax + by = z\} = \{ax + by \mid x, y \in \mathbb{Z}\}\]
   定义 $M$ 为 $\gcd(a, b)$ 所有倍数的集合；即定义
   \[M = \{z \in \mathbb{Z} \mid \exists k \in \mathbb{Z} \centerdot z = k \cdot \gcd(a, b)\} = \{k \cdot \gcd(a, b) \mid k \in \mathbb{Z}\}\]
   则
   \[L = M\]
   换言之，线性丢番图方程 $ax + by = c$ 有解当且仅当 $c$ 是 $\gcd(a, b)$ 的倍数。
\end{theorem}

该定理非常实用，它直接指出线性丢番图方程 $ax + by = c$（其中 $a, b, c \in \mathbb{Z}$）有解的条件：计算 $\gcd(a, b)$ 并验证 $\gcd(a, b) \mid c$。

为了证明此定理，需要证两个\emph{集合相等}。我们将采用\emph{双向包含论证}法（此前已多次使用的策略），此处仅证明一个包含关系，另一个包含关系留作练习。

\begin{proof}
    给定 $a, b \in \mathbb{Z}$。按照定理的陈述定义集合 $L$ 和 $M$。
    \begin{itemize}
        \item 首先，证明 $L \subseteq M$。
        
            设 $z$ 是 $L$ 中任意固定元素。

            由 $L$ 的定义，可知 $\exists x, y \in \mathbb{Z} \centerdot ax + by = z$。给定这样的 $x$ 和 $y$。

            因为 $\gcd(a, b)$ 能整除 $a$ 和 $b$，故 $\exists k, \ell$ 使得 $a = k \cdot \gcd(a, b)$ 且 $b = \ell  \cdot \gcd(a, b)$。给定这样的 $k$ 和 $\ell$。

            将 $a$ 和 $b$ 的表达式代入上面的方程：
            \[z = ax + by = k \cdot \gcd(a, b) \cdot x + \ell \cdot \gcd(a, b) \cdot y = \gcd(a, b) \cdot \underbrace{(kx + \ell y)}_{m}\]

            令 $m = kx + \ell y$。由于 $m \in \mathbb{Z}$，这表明 $z$ 是 $\gcd(a, b)$ 的倍数。

            因此，$z \in M$。这证明了 $L \subseteq M$。\\
        \item 接着，证明 $M \subseteq L$。

            留作练习 \ref{exc:exercises6.7.12}。
    \end{itemize}
\end{proof}

通过此定理的证明，我们可以判定二元线性丢番图方程是否有解。后续练习将要求你基于此结果判断方程解的存在性；若需找出所有解，请采用示例 \ref{ex:example6.5.26} 的方法。

\textbf{挑战性问题}：对于多于两个变量的线性丢番图方程，你认为有哪些可讨论的内容？例如，考虑方程
\[6x + 8y + 15z = 10\]

这个方程有解吗？若有，解的个数是多少？再比如，考虑方程
\[3x + 6y + 9z = 2\]

这个方程是否有解？为什么？

尝试陈述并证明此问题的相关结论。你能否将该结论推广至任意多个变量的情形？
