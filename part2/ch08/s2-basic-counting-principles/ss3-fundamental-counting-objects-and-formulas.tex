% !TeX root = ../../../book.tex

\subsection{基本计数对象和公式}

让我们回到之前提到的扑克牌型计数的例子。我们想知道每种牌型有多少种，以及从一副新洗的 $52$ 张牌中得到同花的方式有多少种。首先，我们可以从一个更简单的问题入手：总共有多少种牌型？换句话说，有多少种方式可以洗完整副 $52$ 张牌，其中有多少种会使前 $5$ 张牌组成相同的牌型？也就是说，我们要找出有多少种不同的洗牌方式；我们称之为\emph{打乱}。接下来，考虑一种特定的牌型，例如 $T\clubsuit\; J\clubsuit\; Q\clubsuit\; K\clubsuit\; A\clubsuit$，并计算有多少种洗牌方式能使前 $5$ 张牌组成该牌型（因为我们不在乎拿到这 $5$ 张牌的顺序，只关心手里有哪些牌）。

我们手头有什么工具？没错，只有加法原理和乘法原理。除此之外，我们还有数学的智慧和直觉。让我们开始吧。洗牌和分区或多步过程有什么关系呢？有趣的是，我们其实并不关心牌是怎么洗的，只关心洗牌的结果数。那么，一副牌最重要的是什么呢？没错，是从上到下牌的顺序。考虑到这一点，我们可以通过确定牌的顺序来构造一个任意的打乱。

我们可以这样洗牌：手中拿着一副牌，一张一张地将牌面朝下放在面前的牌堆上。第一步，我们手中有 $52$ 张牌，没有牌堆，所以有 $52$ 种选择。第二步，无论第一张牌是什么，我们手中剩下 $51$ 张牌可供选择。（记住：这就是乘法原理的关键部分，选择的数量与实际选择无关。）第三步，我们手中剩下 $50$ 张牌，依此类推。最终，第 $52$ 步，我们手中只剩下 $1$ 张牌，要放在桌上 $51$ 张牌的牌堆上。完成这一步后，我们面前就有了一副洗好的牌，牌面朝下堆放。第一步的牌在最底部，最后一步的牌在最顶部。此外，我们发现，对于任何一种洗牌方式，都\emph{有且仅有}一个选择序列可以产生这种洗牌结果。（这就满足了乘法原理的另一部分，即有不同的结果。仔细思考一下，为什么这是必要的。）

这些观察使我们可以直接引用乘法原理来回答这个问题：一副标准扑克牌有多少种打乱方式？这个数字是……
\[52 \cdot 51 \cdot 50 \cdot \dots \cdot 3 \cdot 2 \cdot 1 = \prod_{k \in [52]} k = 8.06581752 \times 10^{67}\]
哇塞！这可真是个天文数字。阿伏伽德罗常数（每摩尔中的原子数）才大约为 $10^{23}$。对于这种乘积，有一种更好的表示法，即``将所有从 $52$ 到 $1$ 的自然数相乘''，你可能以前见过它，但我们现在来定义它。

\begin{definition}
    设 $n \in \mathbb{N}$。自然数 $n!$ 读作 $n$ 的\dotuline{阶乘}，定义为
    \[n! = \prod_{k \in [n]} k = k \cdot (k - 1) \cdot (k - 2) \cdot \dots \cdot 3 \cdot 2 \cdot 1\]
    定义 $0!=1$。
\end{definition}
（回想一下，我们在 \ref{sec:section2.5.1} 节中应用归纳原理编写递归程序来计算阶乘的示例。可以重温一遍那一节！）

让我们来思考一下我们实际上完成了什么。在这个例子中，数字 $52$ 有什么特别之处吗？除了它是一副牌的数量外，并没有什么特别之处！假设我们问：有多少种方法可以将 $[n]$ 的元素排列成有序列表？如果我们将 $n$ 替换为 $52$，这实际上和之前的问题是一样的！（我们可以在牌的集合和 $[52]$ 集合之间建立一个自然的双射关系。你能做到吗？你明白为什么这两个问题是等价的吗？）

\subsubsection*{全排列}

这种类型的问题 --- 有多少种方法可以将 $n$ 个对象排列成一个有序列表 --- 是如此常见，以至于我们为这些有序列表定义了一个特定术语。我们用\emph{函数}的术语严格定义它们，但请注意它们与其他数学对象（例如有序列表）的关系。

\begin{definition}
    设 $n \in \mathbb{N}$。$[n]$ 的\dotuline{全排列 (Permutation)}为双射函数 $f : [n] \to [n]$。

    换句话说，$[n]$ 的全排列就是 $[n]$ 中元素的一个有序 $n$ 元组，并且每个元素只出现一次。
\end{definition}

\begin{proposition} \label{prop:proposition8.2.14}
    设 $n \in \mathbb{N}$。并设 $S$ 为 $[n]$ 上所有全排列的集合。则 $|S| = n!$。
\end{proposition}

\begin{proof}
    我们可以通过依次选择位置上的元素来构造 $[n]$ 的任意排列。首先，从 $n$ 个元素中选择一个作为第一个元素。然后，从剩余的 $n-1$ 个元素中选择一个作为第二个元素。通常，第 $k$ 步时，我们从 $n-(k-1) = n-k+1$ 个未被选择的元素中选取一个作为下一个位置的元素。这个过程一直持续到第 $n-1$ 步，此时只剩下 $1$ 个选项。根据 ROP，共有 $n(n-1)(n-2) \dots 2 \cdot 1 = n!$ 种可能的排列方式。
\end{proof}
（注意：这也解释了为什么我们约定将 $0!$ 定义为 $1$。因为 $n!$ 代表排列 $n$ 个对象的方法数量，而空集的所有元素只有一种排列方式 --- 就是它本身 --- 因此 $0! = 1$ 是合理的。当我们稍后定义\emph{二项式系数}时，这个概念会再次出现；在相应的公式中，$0! = 1$ 将非常有用。）

\subsubsection*{选择}

这从数学上证明了我们关于洗牌观察的一般结论，并使我们更接近扑克牌型排名问题的答案。我们希望确定有多少种不同的洗牌方式能在前五张牌中产生特定类型的五张手牌。为了更好地理解这个问题，我们先从一个更普遍的问题入手。假设有一手特定的牌型，例如 $T\clubsuit\; J\clubsuit\; Q\clubsuit\; K\clubsuit\; A\clubsuit$。现在，我们来计算一下，有多少种洗牌方式能将这手特定的牌型放在前五张牌中。

这种情况是怎么发生的呢？我们并不在乎手牌的顺序，也不在乎牌堆中其他 $47$ 张牌的顺序。关键在于这些特定的牌是否在最上面。因此，让我们按照之前的思路，构造一个满足该条件的洗牌方法。为了使用乘法原理，我们需要找到一个具体的过程来实现这个目标。我们该怎么做呢？

实际上，我们只需要满足两个条件，所以可以设计一个两步过程来确保这些条件成立。第一步，把不在手牌中的 $47$ 张牌按某种顺序放在牌堆底部。第二步，把手牌中的五张牌按某种顺序放在牌堆顶部。这里适用乘法原理，因为无论如何排列底部的 $47$ 张牌，都不会影响我们排列顶部五张牌的方式。（一般来说，在应用乘法原理之前，要理解为什么在特定情况下适用；这通常是微妙且不明显的！）现在，我们只需要计算每一步的排列方式即可。

第一步是对 $47$ 张牌进行排列。命题 \ref{prop:proposition8.2.14} 告诉我们有 $47!$ 种排列方式。

第二步是对五张牌进行排列。命题 \ref{prop:proposition8.2.14} 告诉我们有 $5!$ 种排列方式。

然后，乘法原理告诉我们依次完成这两步的排列方式总数为 $47! \cdot 5!$。就是这样！

我们选择 $T\clubsuit\; J\clubsuit\; Q\clubsuit\; K\clubsuit\; A\clubsuit$ 有什么特别之处吗？没有任何特别之处！再次应用乘法原理，这一事实可以告诉我们更多关于洗牌数量的信息。具体来说，假设 $X$ 是选择五张牌作为手牌的方法数。现在，考虑一个三步过程：从牌堆中取出五张特定的牌，将它们按某种顺序排列，然后将其他 $47$ 张牌排列在下面。这里适用乘法原理，因为每一步的排列方式不依赖于前一步的选择。此外，任何一种洗牌方式都可以通过这个过程唯一确定。（想想为什么这是正确的。考虑任意一种洗牌方式。最上面的五张牌决定了我们在第一步中选择的手牌，排列顺序决定了第二步的执行方式，而其余牌的顺序决定了第三步的执行方式。）因此，我们找到了计算同一组对象（即洗牌方式）的两个公式，所以必然有
\[X \cdot 5! \cdot 47! = 52!\]
因此
\[X = \frac{52!}{5! \cdot 47!}\]
思考一下这个公式告诉了我们什么。我们用 $X$ 表示从 $52$ 张牌中选择 $5$ 张牌的方法数。$5$ 和 $52$ 有什么特别之处吗？答案是，没有！我们实际上推导出了一个公式，用于从一个较大的对象集合中选择任意数量对象的方法数。虽然看起来不像，但我们现在非常接近扑克牌手牌问题的答案了。在完成这个问题之前，让我们先做一个讨论。

首先，我们刚刚使用的论证类型是组合数学中常见且非常有用的证明技术，被称为\emph{双法计数}。我们所做的是识别一组特定的对象 --- 在本例中，是一副牌的洗牌方式 --- 然后描述两种不同的方法来计算该集合的大小。每种方法都得出了不同的公式，但因为我们是在计数同一对象集合，所以我们知道这些公式是相等的。我们将在 \ref{sec:section8.4} 节中更明确地探讨这种类型的论证，还会探讨许多例子。目前，我们希望你能明白为什么这是一种有效的论证方式，特别是因为我们希望你用它来证明下面的命题 \ref{prop:proposition8.2.16}。过程中，你将会概括我们在这里提出的论证。为了说明这一点，让我们总结一下我们所做的工作：

\emph{论证总结}：我们希望找到从 $52$ 张牌中抽取 $5$ 张的方法数量及其表达式。设 $N$ 为我们要找的方法数量。我们将确定两个涉及 $N$ 的不同公式，通过求解这些代数表达式来得到 $N$ 的公式。

\begin{enumerate}[label=(\arabic*)]
    \item 选择任意固定五张手牌。我们将计算出洗牌后使得前五张牌是这组固定手牌的方法数量。

          注意，这一步有 $N$ 种方法可以实现。我们需要找到 $N$ 的公式。
    \item 计算全部 $52$ 张牌的排列数量。
    \item 计算使得前五张牌为固定五张手牌的排列数量。这分为三步：
          \begin{enumerate}[label=(\roman*)]
              \item 计算这五张手牌的排列数量。
              \item 计算余下 $47$ 张牌的排列数量。
              \item 计算将这五张排列好的牌放在那 $47$ 张排列好的牌上面的方法数量。（注意：虽然这里只有一种方法，但作为一个单独步骤指出是很重要的。）
          \end{enumerate}
    \item 总体来说，我们用两种不同的方法计算了一副牌的排列数量（即洗牌），因此它们的结果必然相同。
    \item 通过简化 $N$ 的表达式来得到 $N$ 的公式。
\end{enumerate}
现在，让我们推广刚才推导出的公式。首先，我们给出一个定义并引入一些符号，然后我们再陈述通用公式。

\begin{definition}
    设 $k, n \in \mathbb{N}$ 且 $n \ge k$。从 $[n]$ 中选出 $k$ 个元素的无序集合称为 \dotuline{$k$-选择}。

    $[n]$ 中 $k$-选择的数量用 $\big({n \atop k}\big)$ 表示，这被称为\dotuline{二项式系数}，读作``$n$ 选 $k$''。
\end{definition}

\begin{proposition}\label{prop:proposition8.2.16}
    设 $k, n \in \mathbb{N}$ 且 $n \ge k$。$[n]$ 中 $k$-选择的数量为
    \[\begin{pmatrix}
            n \\
            k
        \end{pmatrix} = \frac{n!}{k! \cdot (n-k)!}\]
\end{proposition}

\begin{proof}
    留作 \ref{sec:section8.2.4} 节练习 \ref{exc:exercises8.2.2}。
\end{proof}

\subsubsection*{二项式系数}

上述公式可能会让你感到惊讶，因为这个分数实际上总是一个自然数，无论 $k$ 和 $n$ 是什么！这是因为它表示的是完成某个过程的方法数，如证明所述，这必须是一个自然数。

我们想指出这个公式的一个你可能没有想到的特殊情况。如果 $k = 0$，会怎样？$\big({n \atop 0}\big)$ 应该是什么？你可能会惊讶地发现 $\big({n \atop 0}\big)=1$。这为什么是合理的呢？直观上，我们认为 $\big({n \atop k}\big)$ 表示的是从 $n$ 个对象中选择 $k$ 个对象的方法数。那么，从 $3$ 个对象中选择 $0$ 个对象有多少种方式呢？将 $3$ 支笔放在桌子上，不选择其中任何一支。没错，什么都不需要做！这是选择 $0$ 个对象的一种方式 --- 也是唯一一种方式。当 $n = 0$ 时，这个论证同样适用！桌子上没有笔，不选择任何一支。看！还是什么都不需要做。因此
\[\forall n \in \mathbb{N} \cup \{0\} \centerdot \begin{pmatrix}
        n \\
        0
    \end{pmatrix}=1\]
对于这个结果，还有``更好''、更数学的解释，我们将在下一节证明帕斯卡恒等式 (Pascal's Identity) 时具体说明。眼下，我们希望通过选择这种启发式解释能够让你理解并接受这个结果。

另一个事实是，当 $K > n$ 时，$\big({n \atop K}\big) = 0$。这是因为，从只有 $3$ 个对象的集合中选择 $5$ 个对象是不可能的。通过我们之前的推导可以证明这一点，因为在某个步骤中，我们会尝试从一副牌中抽取比实际牌数更多的牌，这是不可能的，因此其结果为 $0$。然后，当我们应用 ROP 时，乘积结果也会是 $0$。

如果你尝试一些 $k$ 和 $n$ 的值，你会发现 $\big({n \atop k}\big)$ 的值呈现出所谓的\textbf{单峰分布}。也就是说，如果我们固定 $n$ 并让 $k$ 从 $0$ 增加到 $n$，我们会发现这些数值先上升，在 $\lfloor\frac{n}{2}\rfloor$ 和 $\lceil\frac{n}{2}\rceil$ 处达到峰值（如果 $n$ 为偶数，二者相同），然后再下降。此外，该分布是\emph{中间对称的}！你能证明这些性质吗？试试看吧！

\subsubsection*{排列}

我们现在已经掌握了计算扑克牌组合（以及许多其他对象）所需的所有工具。我们知道如何排列一个集合的元素，也知道如何从一个较大的集合中选择某个特定大小的子集。利用这两个工具，我们可以计算任意牌型组合。例如，要计算扑克牌的一个\emph{有序}子集，我们可以先计算选择这个子集的方式，然后排列其元素，将乘法原理应用到这个两步过程。事实上，这个思想非常常见，以至于我们给它定义了一个名称。

\begin{definition}
    设 $k, n \in \mathbb{N}$ 且 $n \ge k$。从 $[n]$ 中选取 $k$ 个不重复元素组成有序 $k$ 元组称为\dotuline{$k$-排列}。

    换句话说，从 $[n]$ 中选取的 $k$-排列是一个单射函数 $f : [k] \to [n]$。
\end{definition}

\begin{proposition}\label{prop:proposition8.2.18}
    设 $k, n \in \mathbb{N}$ 且 $n \ge k$。$[n]$ 中 $k$-排列的数量为 $\big({n \atop k}\big) \cdot k! = \frac{n!}{(n-k)!}$。
\end{proposition}

\begin{proof}
    留作 \ref{sec:section8.2.4} 节练习 \ref{exc:exercises8.2.3}。
\end{proof}

\subsubsection*{重复}

在我们继续计数扑克牌牌型之前，需要指出的是，本节中介绍的所有标准计数公式都假设对象不能\emph{重复}。也就是说，当我们从一副牌中选出五张牌时，不能有两张 $A \clubsuit$。但在某些情况下，我们希望对象可以重复。回顾上一节中的车牌示例，我们可以重复使用任意数字或字母，例如，$111AAA$ 是一个有效的车牌。让我们再看一个例子：\\

\begin{example}
    考虑一个标准的、公平的两面硬币。连续投掷硬币 $6$ 次，并记录每次的结果，用 \verb|H| 或 \verb|T| 表示每次投掷的结果。

    \emph{问题}: 有多少种可能的结果？

    要回答这个问题，我们注意到每次抛硬币都有 $2$ 种可能的结果，并且前几次的结果不会影响后面的结果。因此，根据乘法原理，我们可以计算出有 $2 \times 2 \times 2 \times 2 \times 2 \times 2 = 2^6 = 64$ 种可能的结果。
\end{example}

这一思想与选择和排列有关的原因（除了使用乘法原理外）是我们也可以将这些序列表示为从集合 ${\verb|H|, \verb|T|}$ 中选择 $6$ 个对象的排列，其中对象可以重复出现。（在 ${\verb|H|, \verb|T|}$ 和 $[2]$ 之间有自然的对应关系，这就像我们在排列 $[2]$ 中的 $6$ 个对象，其中对象可以重复。）

这个一般思想通过以下定义传达出来：

\begin{definition}
    设 $k, n \in \mathbb{N}$。从 $[n]$ 中选取 $k$ 个可重复元素组成有序 $k$ 元组称为\dotuline{可重复 $k$-排列}。
\end{definition}

注意，这里对 $k$ 没有任何限制，因为我们允许元素可以重复出现。以前，对于不重复的 $k$ 排列，如果不能重复选择元素，那么从 $8$ 个对象中选择 $10$ 个对象是没有意义的！然而，在这里，这是允许的，因此 $k$ 和 $n$ 可以是任意自然数。

\begin{proposition}\label{prop:proposition8.2.21}
    设 $k, n \in \mathbb{N}$。$[n]$ 中可重复 $k$-排列的数量为 $n^k$。
\end{proposition}

\begin{proof}
    留作 \ref{sec:section8.2.4} 节练习 \ref{exc:exercises8.2.4}。
\end{proof}

你可能会期待关于可重复 $k$-选择的定义和命题。我们将在 \ref{sec:section8.5} 节讨论这些内容，但由于计数这些选择的方法更为复杂，我们将稍后再详细介绍。

\subsubsection*{计数公式总结}\label{sec:section8.2.3}

让我们总结一下到目前为止定义和推导的标准计数对象和公式：假设有 $n$ 个对象，我们需要从中选择 $k$ 个。可以有多少种选择方法？这取决于两个问题：
\begin{itemize}
    \item 是否允许重复？
    \item 顺序是否重要？
\end{itemize}
每个问题的回答要么为``\verb|是|''要么为``\verb|否|''，不同的答案都会导致不同的公式。
\begin{center}
    \begin{tabular}{lcccc}
               &          &          & 允许重复吗？ &                                       \\
               &          & \verb|是| &        & \verb|否|                              \\
               & \verb|是| & $n^k$    &        & $\displaystyle \frac{n!}{(n-k)!}$     \\
        顺序重要吗？ &          &          &        &                                       \\
               & \verb|否| & ???      &        & $\begin{pmatrix}
                                                                               n \\
                                                                               k
                                                                           \end{pmatrix}$
    \end{tabular}
\end{center}
（注意：有时候，问题中 $n$ 和 $k$ 的作用会被颠倒，这一点需要特别注意！我们会尽量遵循这些约定，但总体来说，字母本身并不重要，重要的是它们所代表的含义。）

\subsubsection*{组合数学的函数定义}

请记住，这些计数方法在\emph{函数}方面也有等价的表述，牢记这一点会大有裨益。用函数来表述问题可能有助于我们解决它。至少，它是一个很好的思维训练，例如让你理解\emph{全排列}和\emph{双射}之间的关系。我们将陈述这些表述（以及相应的公式），并希望你能自己思考这些内容。试着理解这些概念为何以及如何相关；尝试向只知道其中一种解释的朋友解释它们；与同学合作，或许能提出不同的表述！

\begin{itemize}
    \item $n$ 个元素的\textbf{全排列}是双射函数 $f : [n] \to [n]$。\\
          从集合 $[n]$ 到其自身共有 $n!$ 种可能的双射。
    \item 从 $n$ 个元素中选择 $k$ 个元素的\textbf{排列}是单射函数 $f : [k] \to [n]$。\\
          从 $[k]$ 到 $[n]$ 共有 $\frac{n!}{(n-k)!}$ 种可能的单射。
    \item 从 $n$ 个元素中选择 $k$ 个元素的\textbf{可重复排列}是函数 $f : [k] \to [n]$。 \\
          从 $[k]$ 到 $[n]$ 共有 $n^k$ 种可能的函数。
\end{itemize}